# 架构情况

![未命名文件](%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.assets/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6.jpg)

其中，网关启动了两个微服务，student启动了两个微服务，课程启动了三个微服务，seata启动了两个服务。其他的服务均启动了一个。

在以后的使用中，可以根据实际情况启动相应数量的微服务，因为都是注册到nacos中的，所以横向扩展非常高效。

# 问题

由于我只有一个服务器，所以无法完成分布式的部署。在仅仅启动了服务，没有发生高并发的情况下，已经占用了大量的内存。所以

在部署后无法发挥出分布式的优势。

![image-20220618221020312](%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.assets/image-20220618221020312.png)

# 服务器参数

1. 服务商：阿里云
2. CPU&内存：4核(vCPU)16 GiB
3. 操作系统：CentOS 8.4 64位
4. 实例规格：[ecs.g5.xlarge](https://help.aliyun.com/document_detail/25378.html#g5)
5. 实例规格族：ecs.g5

# 接口

根据实际场景，我主要针对访问首页，学生登录，学生获取课表选课这些可能存在高并发的接口进行了压力测试。

### 首页

##### 场景1

线程数: 1000; ramp-up: 1; 循环: 5

![image-20220618221243138](%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.assets/image-20220618221243138.png)

##### 场景2

线程数: 1500; ramp-up: 1; 循环: 5

![image-20220618221054818](%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.assets/image-20220618221054818.png)



### 学生登录（学生微服务实例数量为1）

##### 场景1

线程数: 1000; ramp-up: 1; 循环: 5

![image-20220618221615393](%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.assets/image-20220618221615393.png)

##### 场景2

线程数: 1500; ramp-up: 1; 循环: 5

![image-20220618221821343](%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.assets/image-20220618221821343.png)

### 学生获取课表（学生微服务实例数量为1）

##### 场景1

线程数: 1000; ramp-up: 1; 循环: 5

![image-20220618221635318](%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.assets/image-20220618221635318.png)

##### 场景2

线程数: 1500; ramp-up: 1; 循环: 5

![image-20220618221842474](%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.assets/image-20220618221842474.png)

### 学生登录（学生微服务实例数量为2）

##### 场景1

线程数: 1000; ramp-up: 1; 循环: 5

![image-20220618221257068](%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.assets/image-20220618221257068.png)

##### 场景2

线程数: 1500; ramp-up: 1; 循环: 5

![image-20220618221109886](%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.assets/image-20220618221109886.png)



### 学生获取课表（学生微服务实例数量为2）

##### 场景1

线程数: 1000; ramp-up: 1; 循环: 5

![image-20220618221321125](%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.assets/image-20220618221321125.png)

##### 场景2

线程数: 1500; ramp-up: 1; 循环: 5

![image-20220618221156084](%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.assets/image-20220618221156084.png)



# 结论

综上

1. 在线程数量为1500时比1000时的性能有明显下降。
   请求的最大相应时间和99%百分位有非常显著提升。
   请求的90%百分位有明显提升
2. 在开启了两个学生微服务之后，平均响应时间有所下降。吞吐量提升了近一倍。99%百分位有所优化。